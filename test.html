<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KNMI & Rijkswaterstaat Data Test</title>
  </head>
  <body>
    <h1>Test KNMI & Rijkswaterstaat Data Fetch</h1>

    <!-- KNMI Data Fetch Section -->
    <section>
      <h2>KNMI Data</h2>
      <button id="fetchKNMIData">Fetch KNMI Data</button>
      <pre
        id="responseOutputKNMI"
        style="
          background: #f4f4f4;
          padding: 1em;
          border: 1px solid #ccc;
          margin-top: 1em;
          white-space: pre-wrap;
          word-wrap: break-word;
        "
      ></pre>
    </section>

    <!-- Rijkswaterstaat Data Fetch Section -->
    <section>
      <h2>Rijkswaterstaat Data</h2>
      <button id="fetchRWSData">Fetch Rijkswaterstaat Data</button>
      <pre
        id="responseOutputRWS"
        style="
          background: #f4f4f4;
          padding: 1em;
          border: 1px solid #ccc;
          margin-top: 1em;
          white-space: pre-wrap;
          word-wrap: break-word;
        "
      ></pre>
    </section>

    <script>
      // KNMI Data Fetch Logic
      document
        .getElementById('fetchKNMIData')
        .addEventListener('click', async () => {
          const responseOutput = document.getElementById('responseOutputKNMI');
          responseOutput.textContent = 'Fetching KNMI data...';

          try {
            const response = await fetch(
              'http://localhost:3000/api/knmi/hoek-van-holland/last-three-hours',
              {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
              }
            );

            if (!response.ok) {
              let errorDetails = 'No additional details provided.';
              try {
                errorDetails = await response.json();
              } catch (parseError) {
                console.error('Failed to parse error details:', parseError);
              }

              throw new Error(
                `Error: ${response.status} ${
                  response.statusText
                }. Details: ${JSON.stringify(errorDetails)}`
              );
            }

            const data = await response.json();
            console.log('KNMI Data ontvangen van backend:', data);

            responseOutput.textContent = JSON.stringify(data, null, 2);
          } catch (error) {
            console.error('Fout bij het ophalen van KNMI-data:', error.message);
            responseOutput.textContent = `Error: ${error.message}`;
          }
        });

      // Rijkswaterstaat Data Fetch Logic
      document
        .getElementById('fetchRWSData')
        .addEventListener('click', async () => {
          const responseOutput = document.getElementById('responseOutputRWS');
          responseOutput.textContent = 'Fetching Rijkswaterstaat data...';

          try {
            const response = await fetch(
              'http://localhost:3000/api/rws/details',
              {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  LocatieLijst: [
                    { Code: 'HOEK', X: 576917.675576278, Y: 5759136.13463449 },
                  ],
                  AquoPlusWaarnemingMetadataLijst: [
                    {
                      AquoMetadata: {
                        Compartiment: { Code: 'OW' },
                        Grootheid: { Code: 'T' },
                      },
                    },
                    {
                      AquoMetadata: {
                        Compartiment: { Code: 'LT' },
                        Grootheid: { Code: 'T' },
                      },
                    },
                  ],
                }),
              }
            );

            if (!response.ok) {
              throw new Error(
                `Error: ${response.status} ${response.statusText}`
              );
            }

            const data = await response.json();
            console.log('Rijkswaterstaat Data ontvangen van backend:', data);

            responseOutput.textContent = JSON.stringify(data, null, 2);
          } catch (error) {
            console.error(
              'Fout bij het ophalen van Rijkswaterstaat-data:',
              error.message
            );
            responseOutput.textContent = `Error: ${error.message}`;
          }
        });
    </script>
  </body>
</html>
